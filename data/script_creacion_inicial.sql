-----------------------------------------------------------------------
-- MASTER TABLE
USE GD2C2015;

-----------------------------------------------------------------------
-- SCHEMA

IF NOT EXISTS (
    SELECT schema_name 
    FROM information_schema.schemata 
    WHERE schema_name = 'DIVIDIDOS' 
    )

BEGIN
    EXEC sp_executesql N'CREATE SCHEMA DIVIDIDOS;';
END

-- DROPS

IF OBJECT_ID('DIVIDIDOS.aeronaves') IS NOT NULL
BEGIN
DROP TABLE DIVIDIDOS.aeronaves;
END;

-----------------------------------------------------------------------
-- DROP TABLES

IF OBJECT_ID('DIVIDIDOS.aeronaves') IS NOT NULL
BEGIN
    DROP TABLE DIVIDIDOS.aeronaves;
END;

IF OBJECT_ID('DIVIDIDOS.fabricantes') IS NOT NULL
BEGIN
    DROP TABLE DIVIDIDOS.fabricantes;
END;

IF OBJECT_ID('DIVIDIDOS.tipos_de_servicios') IS NOT NULL
BEGIN
    DROP TABLE DIVIDIDOS.tipos_de_servicios;
END;

IF OBJECT_ID('DIVIDIDOS.butacas') IS NOT NULL
BEGIN
    DROP TABLE DIVIDIDOS.butacas;
END;

IF OBJECT_ID('DIVIDIDOS.pasajes') IS NOT NULL
BEGIN
    DROP TABLE DIVIDIDOS.pasajes;
END;

IF OBJECT_ID('DIVIDIDOS.clientes') IS NOT NULL
BEGIN
    DROP TABLE DIVIDIDOS.clientes;
END;

IF OBJECT_ID('DIVIDIDOS.boletos_de_compra') IS NOT NULL
BEGIN
    DROP TABLE DIVIDIDOS.boletos_de_compra;
END;

IF OBJECT_ID('DIVIDIDOS.roles') IS NOT NULL
BEGIN
    DROP TABLE DIVIDIDOS.roles;
END;

IF OBJECT_ID('DIVIDIDOS.funcionalidades') IS NOT NULL
BEGIN
    DROP TABLE DIVIDIDOS.funcionalidades;
END;

IF OBJECT_ID('DIVIDIDOS.funcionalidades_por_rol') IS NOT NULL
BEGIN
    DROP TABLE DIVIDIDOS.funcionalidades_por_rol;
END;

IF OBJECT_ID('DIVIDIDOS.administradores') IS NOT NULL
BEGIN
    DROP TABLE DIVIDIDOS.administradores;
END;

IF OBJECT_ID('DIVIDIDOS.productos') IS NOT NULL
BEGIN
    DROP TABLE DIVIDIDOS.productos;
END;

IF OBJECT_ID('DIVIDIDOS.periodos_de_inactividad') IS NOT NULL
BEGIN
    DROP TABLE DIVIDIDOS.periodos_de_inactividad;
END;

IF OBJECT_ID('DIVIDIDOS.aeronaves_por_periodos') IS NOT NULL
BEGIN
    DROP TABLE DIVIDIDOS.aeronaves_por_periodos;
END;

IF OBJECT_ID('DIVIDIDOS.servicios_por_rutas') IS NOT NULL
BEGIN
    DROP TABLE DIVIDIDOS.servicios_por_rutas;
END;

IF OBJECT_ID('DIVIDIDOS.aeropuertos') IS NOT NULL
BEGIN
    DROP TABLE DIVIDIDOS.aeropuertos;
END;

IF OBJECT_ID('DIVIDIDOS.vuelos') IS NOT NULL
BEGIN
    DROP TABLE DIVIDIDOS.vuelos;
END;

IF OBJECT_ID('DIVIDIDOS.rutas') IS NOT NULL
BEGIN
    DROP TABLE DIVIDIDOS.rutas;
END;

IF OBJECT_ID('DIVIDIDOS.encomiendas') IS NOT NULL
BEGIN
    DROP TABLE DIVIDIDOS.encomiendas;
END;

IF OBJECT_ID('DIVIDIDOS.ciudades') IS NOT NULL
BEGIN
    DROP TABLE DIVIDIDOS.ciudades;
END;

IF OBJECT_ID('DIVIDIDOS.paquetes') IS NOT NULL
BEGIN
    DROP TABLE DIVIDIDOS.paquetes;
END;

IF OBJECT_ID('DIVIDIDOS.canjes') IS NOT NULL
BEGIN
    DROP TABLE DIVIDIDOS.canjes;
END;

IF OBJECT_ID('DIVIDIDOS.tarjetas_de_credito') IS NOT NULL
BEGIN
    DROP TABLE DIVIDIDOS.tarjetas_de_credito;
END;

IF OBJECT_ID('DIVIDIDOS.cancelaciones') IS NOT NULL
BEGIN
    DROP TABLE DIVIDIDOS.cancelaciones;
END;


-----------------------------------------------------------------------
-- TABLES

CREATE TABLE DIVIDIDOS.aeronaves (
    ID  INT   IDENTITY(1,1)    PRIMARY KEY,
    MATRICULA        NVARCHAR(255)    UNIQUE NOT NULL,
    MODELO        NVARCHAR(255),
    KG_DISPONIBLES    NUMERIC(18,0)    NOT NULL,
    FABRICANTE_ID    INT            NOT NULL,
    TIPO_SERVICIO_ID    INT            NOT NULL,
    BAJA            NVARCHAR(255),
    FECHA_ALTA      DATETIME        NOT NULL,
    CANT_BUTACAS    INT            NOT NULL,
    FECHA_BAJA    DATETIME,
    CONSTRAINT CK001 CHECK (BAJA IN ('DEFINITIVA', 'POR PERIODO'))
)

CREATE TABLE DIVIDIDOS.fabricantes (
    ID  INT  IDENTITY(1,1)    PRIMARY KEY,
    NOMBRE        NVARCHAR(255)    NOT NULL
)

CREATE TABLE DIVIDIDOS.tipos_de_servicios (
    ID INT   IDENTITY(1,1)    PRIMARY KEY,
    NOMBRE        NVARCHAR(255)    NOT NULL
)

CREATE TABLE DIVIDIDOS.butacas (
    ID  INT     IDENTITY(1,1)    PRIMARY KEY,
    NUMERO        NUMERIC(18,0)    NOT NULL,
    TIPO            NVARCHAR(255),
    PISO            NUMERIC(18,0),
    AERONAVE_ID    INT            NOT NULL,
    ESTADO        NVARCHAR(255),
    CONSTRAINT CK002 CHECK (TIPO IN ('VENTANILLA', 'PASILLO')),
    CONSTRAINT CK003 CHECK (ESTADO IN ('LIBRE', 'COMPRADO'))
)

CREATE TABLE DIVIDIDOS.pasajes (
    ID    INT    IDENTITY(1,1)    PRIMARY KEY,
    FECHA_COMPRA    DATETIME        NOT NULL,
    PRECIO        NUMERIC(18,2),
    CODIGO        NUMERIC(18,0)    UNIQUE NOT NULL,
    BUTACA_ID        INT            NOT NULL,
    CLIENTE_ID        INT            NOT NULL,
    BOLETO_COMPRA_ID INT
)

CREATE TABLE DIVIDIDOS.clientes (
    ID   INT     IDENTITY(1,1)    PRIMARY KEY,
    ROL_ID        INT            NOT NULL,
    NOMBRE        NVARCHAR(255)    NOT NULL,
    APELLIDO        NVARCHAR(255),
    DNI            NUMERIC(18,0)    UNIQUE NOT NULL,
    DIRECCION        NVARCHAR(255),
    TELEFONO        NUMERIC(18,0),
    MAIL            NVARCHAR(255),
    FECHA_NACIMIENTO DATETIME,
    MILLAS_ACUMULADAS INT
)

CREATE TABLE DIVIDIDOS.boletos_de_compra (
    ID INT IDENTITY(1,1)    PRIMARY KEY,
    CODIGO_COMPRA    NUMERIC(18,0)    NOT NULL,
    FECHA_COMPRA    DATETIME,
    PRECIO_COMPRA    NUMERIC(18,2),
    TIPO_COMPRA    NVARCHAR(255),
    CLIENTE_ID        INT            NOT NULL,
    CONSTRAINT CK004 CHECK (TIPO_COMPRA IN ('EFECTIVO', 'TARJETA'))
)

CREATE TABLE DIVIDIDOS.roles (
    ID    INT    IDENTITY(1,1)    PRIMARY KEY
)

CREATE TABLE DIVIDIDOS.funcionalidades (
    ID INT IDENTITY(1,1)    PRIMARY KEY,
    DETALLES        NVARCHAR(255)
)

CREATE TABLE DIVIDIDOS.funcionalidades_por_rol (
	ROL_ID    INT,
	FUNCIONALIDAD_ID INT, 
	PRIMARY KEY(ROL_ID,FUNCIONALIDAD_ID)
)

CREATE TABLE DIVIDIDOS.administradores (
    ID INT IDENTITY(1,1)    PRIMARY KEY,
    ROL_ID        INT            NOT NULL ,
    USERNAME        NVARCHAR(255)    UNIQUE NOT NULL,
    PASSWORD        NVARCHAR(255)    
)

CREATE TABLE DIVIDIDOS.productos (
    ID  INT  IDENTITY(1,1)    PRIMARY KEY,
    NOMBRE        NVARCHAR(255)    UNIQUE,
    MILAS_REQUERIDAS INT,
    STOCK        INT        
)

CREATE TABLE DIVIDIDOS.periodos_de_inactividad (
    ID    INT     IDENTITY(1,1)    PRIMARY KEY,
    DESDE        DATETIME,
    HASTA        DATETIME
)

CREATE TABLE DIVIDIDOS.aeronaves_por_periodos (
    AERONAVE_ID INT,
    PERIODO_ID  INT,
    PRIMARY KEY(AERONAVE_ID,PERIODO_ID)
)

CREATE TABLE DIVIDIDOS.servicios_por_rutas (
	TIPO_SERVICIO_ID   INT  ,
    RUTA_ID   INT,
    PRIMARY KEY(TIPO_SERVICIO_ID, RUTA_ID)
)

CREATE TABLE DIVIDIDOS.aeropuertos (
    ID  INT    IDENTITY(1,1)    PRIMARY KEY,
    NOMBRE        NVARCHAR(255),
    CIUDAD_ID        INT             NOT NULL
)

CREATE TABLE DIVIDIDOS.vuelos (
    ID     INT    IDENTITY(1,1)     PRIMARY KEY,
    FECHA_SALIDA     DATETIME,
    FECHA_LLEGADA     DATETIME,
    FECHA_LLEGADA_ESTIMADA DATETIME,
    AERONAVE_ID     INT            NOT NULL,
    RUTA_ID         INT            NOT NULL
)

CREATE TABLE DIVIDIDOS.rutas (
    ID     INT     IDENTITY(1,1)     PRIMARY KEY,
    CODIGO         NUMERIC(18,0)    UNIQUE NOT NULL,
    PRECIO_BASE_KG     NUMERIC(18,2),
    PRECIO_BASE_PASAJE NUMERIC(18,2),
    ORIGEN_ID        INT            NOT NULL,
    DESTINO_ID        INT            NOT NULL,
    TIPO_SERVICIO_ID    INT            NOT NULL
)

CREATE TABLE DIVIDIDOS.encomiendas (
    ID  INT    IDENTITY(1,1)    PRIMARY KEY,
    BOLETO_COMPRA_ID INT,
    VUELO_ID         INT
)

CREATE TABLE DIVIDIDOS.ciudades (
    ID     INT     IDENTITY(1,1)     PRIMARY KEY,
    NOMBRE         NVARCHAR(255)    NOT NULL
)

CREATE TABLE DIVIDIDOS.paquetes(
    ID   INT  IDENTITY(1,1)     PRIMARY KEY,
    CODIGO         NUMERIC(18,0)    UNIQUE NOT NULL,
    PRECIO         NUMERIC(18,2),
    KG             NUMERIC(18,0),
    FECHA         DATETIME,
    ENCOMIENDA_ID     INT
)

CREATE TABLE DIVIDIDOS.canjes (
    ID     INT    IDENTITY(1,1)     PRIMARY KEY,
    CLIENTE_ID         INT             NOT NULL,
    PRODUCTO_ID     INT             NOT NULL,
    CANTIDAD         INT,
    FECHA         DATETIME
)

CREATE TABLE DIVIDIDOS.tarjetas_de_credito (
    ID   INT   IDENTITY(1,1)     PRIMARY KEY,
    TIPO             NVARCHAR(255),
    NUMERO         NUMERIC(18,0)    UNIQUE NOT NULL,
    CODIGO_SEGURIDAD NUMERIC(18,0)    NOT NULL,
    FECHA_VTO         DATETIME        NOT NULL,
    CLIENTE_ID         INT            NOT NULL
)

CREATE TABLE DIVIDIDOS.cancelaciones (
    ID   INT   IDENTITY(1,1)     PRIMARY KEY,
    FECHA_DEVOLUCION DATETIME,
    BOLETO_COMPRA_ID INT            NOT NULL,
    MOTIVO         NVARCHAR(255)
)

-----------------------------------------------------------------------
-- FOREIGN KEYS && INDEXES

ALTER TABLE DIVIDIDOS.aeronaves
ADD CONSTRAINT AERONAVES_FK01 FOREIGN KEY
(FABRICANTE_ID) REFERENCES DIVIDIDOS.fabricantes (ID)

IF NOT EXISTS(SELECT * FROM sys.indexes WHERE name = 'AERO_FABRIC' AND object_id = OBJECT_ID('DIVIDIDOS.aeronaves'))
    BEGIN
       CREATE INDEX AERO_FABRIC ON DIVIDIDOS.aeronaves (FABRICANTE_ID);
    END

ALTER TABLE DIVIDIDOS.aeronaves
ADD CONSTRAINT AERONAVES_FK02 FOREIGN KEY
(TIPO_SERVICIO_ID) REFERENCES DIVIDIDOS.tipos_de_servicio (ID)

IF NOT EXISTS(SELECT * FROM sys.indexes WHERE name = 'AERO_TIPO_SERV' AND object_id = OBJECT_ID('DIVIDIDOS.aeronaves'))
    BEGIN
       CREATE INDEX AERO_TIPO_SERV ON DIVIDIDOS.aeronaves (TIPO_SERVICIO_ID);
    END

ALTER TABLE DIVIDIDOS.butacas
ADD CONSTRAINT BUTACAS_FK01 FOREIGN KEY
(AERONAVE_ID) REFERENCES DIVIDIDOS.aeronaves (ID)

IF NOT EXISTS(SELECT * FROM sys.indexes WHERE name = 'BUTAC_AERO' AND object_id = OBJECT_ID('DIVIDIDOS.butacas'))
    BEGIN
       CREATE INDEX BUTAC_AERO ON DIVIDIDOS.butacas (AERONAVE_ID);
    END

ALTER TABLE DIVIDIDOS.pasajes
ADD CONSTRAINT PASAJES_FK01 FOREIGN KEY
(BUTACA_ID) REFERENCES DIVIDIDOS.butacas (ID)

IF NOT EXISTS(SELECT * FROM sys.indexes WHERE name = 'PASAJ_BUTAC' AND object_id = OBJECT_ID('DIVIDIDOS.pasajes'))
    BEGIN
       CREATE INDEX PASAJ_BUTAC ON DIVIDIDOS.pasajes (BUTACA_ID);
    END

ALTER TABLE DIVIDIDOS.pasajes
ADD CONSTRAINT PASAJES_FK02 FOREIGN KEY
(CLIENTE_ID) REFERENCES DIVIDIDOS.clientes (ID)

IF NOT EXISTS(SELECT * FROM sys.indexes WHERE name = 'PASAJ_CLIENT' AND object_id = OBJECT_ID('DIVIDIDOS.pasajes'))
    BEGIN
       CREATE INDEX PASAJ_CLIENT ON DIVIDIDOS.pasajes (CLIENTE_ID);
    END

ALTER TABLE DIVIDIDOS.pasajes
ADD CONSTRAINT PASAJES_FK03 FOREIGN KEY
(BOLETO_COMPRA_ID) REFERENCES DIVIDIDOS.boletos_de_compra (ID)

IF NOT EXISTS(SELECT * FROM sys.indexes WHERE name = 'PASAJ_BOL_COMP' AND object_id = OBJECT_ID('DIVIDIDOS.pasajes'))
    BEGIN
       CREATE INDEX PASAJ_BOL_COMP ON DIVIDIDOS.pasajes (BOLETO_COMPRA_ID);
    END

ALTER TABLE DIVIDIDOS.clientes
ADD CONSTRAINT CLIENTES_FK01 FOREIGN KEY
(ROL_ID) REFERENCES DIVIDIDOS.roles (ID)

IF NOT EXISTS(SELECT * FROM sys.indexes WHERE name = 'CLIENT_ROLES' AND object_id = OBJECT_ID('DIVIDIDOS.clientes'))
    BEGIN
       CREATE INDEX CLIENT_ROLES ON DIVIDIDOS.clientes (ROL_ID);
    END

ALTER TABLE DIVIDIDOS.boletos_de_compra
ADD CONSTRAINT BOLETOS_DE_COMPRA_FK01 FOREIGN KEY
(CLIENTE_ID) REFERENCES DIVIDIDOS.clientes (ID)

IF NOT EXISTS(SELECT * FROM sys.indexes WHERE name = 'FKI_BOL_COMP_CLIENT' AND object_id = OBJECT_ID('DIVIDIDOS.boletos_de_compra'))
    BEGIN
       CREATE INDEX FKI_BOL_COMP_CLIENT ON DIVIDIDOS.boletos_de_compra (CLIENTE_ID);
    END

ALTER TABLE DIVIDIDOS.funcionalidades_por_rol
ADD CONSTRAINT FUNCIONALIDADES_POR_ROL_FK01 FOREIGN KEY
(ROL_ID) REFERENCES DIVIDIDOS.roles (ID)

IF NOT EXISTS(SELECT * FROM sys.indexes WHERE name = 'FKI_FUNCXROL_ROL' AND object_id = OBJECT_ID('DIVIDIDOS.funcionalidades_por_rol'))
    BEGIN
       CREATE INDEX FKI_FUNCXROL_ROL ON DIVIDIDOS.funcionalidades_por_rol (ROL_ID);
    END

ALTER TABLE DIVIDIDOS.funcionalidades_por_rol
ADD CONSTRAINT FUNCIONALIDADES_POR_ROL_FK02 FOREIGN KEY
(FUNCIONALIDAD_ID) REFERENCES DIVIDIDOS.funcionalidades (ID)

IF NOT EXISTS(SELECT * FROM sys.indexes WHERE name = 'FKI_FUNCXROL_FUNC' AND object_id = OBJECT_ID('DIVIDIDOS.funcionalidades_por_rol'))
    BEGIN
       CREATE INDEX FKI_FUNCXROL_FUNC ON DIVIDIDOS.funcionalidades_por_rol (FUNCIONALIDAD_ID);
    END

ALTER TABLE DIVIDIDOS.administradores
ADD CONSTRAINT ADMINISTRADORES_FK01 FOREIGN KEY
(ROL_ID) REFERENCES DIVIDIDOS.roles (ID_ROL)

IF NOT EXISTS(SELECT * FROM sys.indexes WHERE name = 'FKI_ADM_ROL' AND object_id = OBJECT_ID('DIVIDIDOS.administradores'))
    BEGIN
       CREATE INDEX FKI_ADM_ROL ON DIVIDIDOS.administradores (ROL_ID);
    END

ALTER TABLE DIVIDIDOS.aeronaves_por_periodos
ADD CONSTRAINT AERONAVES_POR_PERIODOS_FK01 FOREIGN KEY
(AERONAVE_ID) REFERENCES DIVIDIDOS.aeronaves (ID)

IF NOT EXISTS(SELECT * FROM sys.indexes WHERE name = 'FKI_AEROXPER_AERO' AND object_id = OBJECT_ID('DIVIDIDOS.aeronaves_por_periodos'))
    BEGIN
       CREATE INDEX FKI_AEROXPER_AERO ON DIVIDIDOS.aeronaves_por_periodos (AERONAVE_ID);
    END

ALTER TABLE DIVIDIDOS.aeronaves_por_periodos
ADD CONSTRAINT AERONAVES_POR_PERIODOS_FK02 FOREIGN KEY
(PERIODO_ID) REFERENCES DIVIDIDOS.periodos_de_inactividad (ID)

IF NOT EXISTS(SELECT * FROM sys.indexes WHERE name = 'FKI_AEROXPER_PERXINAC' AND object_id = OBJECT_ID('DIVIDIDOS.aeronaves_por_periodos'))
    BEGIN
       CREATE INDEX FKI_AEROXPER_PERXINAC ON DIVIDIDOS.aeronaves_por_periodos (PERIODO_ID);
    END

ALTER TABLE DIVIDIDOS.servicios_por_rutas
ADD CONSTRAINT SERVICIOS_POR_RUTAS_FK01 FOREIGN KEY
(TIPO_SERVICIO_ID) REFERENCES DIVIDIDOS.tipos_de_servicios (ID)

IF NOT EXISTS(SELECT * FROM sys.indexes WHERE name = 'FKI_SERVXRUT_TIPOSERV' AND object_id = OBJECT_ID('DIVIDIDOS.servicios_por_rutas'))
    BEGIN
       CREATE INDEX FKI_SERVXRUT_TIPOSERV ON DIVIDIDOS.servicios_por_rutas (TIPO_SERVICIO_ID);
    END

ALTER TABLE DIVIDIDOS.servicios_por_rutas
ADD CONSTRAINT SERVICIOS_POR_RUTAS_FK02 FOREIGN KEY
(RUTA_ID) REFERENCES DIVIDIDOS.rutas (ID)

IF NOT EXISTS(SELECT * FROM sys.indexes WHERE name = 'FKI_SERVXRUT_RUT' AND object_id = OBJECT_ID('DIVIDIDOS.servicios_por_rutas'))
    BEGIN
       CREATE INDEX FKI_SERVXRUT_RUT ON DIVIDIDOS.servicios_por_rutas (RUTA_ID);
    END

ALTER TABLE DIVIDIDOS.aeropuertos
ADD CONSTRAINT AEROPUERTOS_FK01 FOREIGN KEY
(CIUDAD_ID) REFERENCES DIVIDIDOS.ciudades (ID)

IF NOT EXISTS(SELECT * FROM sys.indexes WHERE name = 'FKI_AERO_CIUD' AND object_id = OBJECT_ID('DIVIDIDOS.aeropuertos'))
    BEGIN
       CREATE INDEX FKI_AERO_CIUD ON DIVIDIDOS.aeropuertos (CIUDAD_ID);
    END

ALTER TABLE DIVIDIDOS.vuelos
ADD CONSTRAINT VUELOS_FK01 FOREIGN KEY
(AERONAVE_ID) REFERENCES DIVIDIDOS.aeronaves (ID)

IF NOT EXISTS(SELECT * FROM sys.indexes WHERE name = 'FKI_VUEL_AERO' AND object_id = OBJECT_ID('DIVIDIDOS.vuelos'))
    BEGIN
       CREATE INDEX FKI_VUEL_AERO ON DIVIDIDOS.vuelos (AERONAVE_ID);
    END

ALTER TABLE DIVIDIDOS.vuelos
ADD CONSTRAINT VUELOS_FK02 FOREIGN KEY
(RUTA_ID) REFERENCES DIVIDIDOS.rutas (ID)

IF NOT EXISTS(SELECT * FROM sys.indexes WHERE name = 'FKI_VUEL_RUT' AND object_id = OBJECT_ID('DIVIDIDOS.vuelos'))
    BEGIN
       CREATE INDEX FKI_VUEL_RUT ON DIVIDIDOS.vuelos (RUTA_ID);
    END

ALTER TABLE DIVIDIDOS.rutas
ADD CONSTRAINT RUTAS_FK01 FOREIGN KEY
(TIPO_SERVICIO_ID) REFERENCES DIVIDIDOS.tipos_de_servicio (ID)

IF NOT EXISTS(SELECT * FROM sys.indexes WHERE name = 'FKI_RUT_TIPOSERV' AND object_id = OBJECT_ID('DIVIDIDOS.rutas'))
    BEGIN
       CREATE INDEX FKI_RUT_TIPOSERV ON DIVIDIDOS.rutas (TIPO_SERVICIO_ID);
    END

ALTER TABLE DIVIDIDOS.rutas
ADD CONSTRAINT RUTAS_FK02 FOREIGN KEY
(ORIGEN_ID) REFERENCES DIVIDIDOS.aeropuertos (ID)

IF NOT EXISTS(SELECT * FROM sys.indexes WHERE name = 'FKI_RUT_AERO' AND object_id = OBJECT_ID('DIVIDIDOS.rutas'))
    BEGIN
       CREATE INDEX FKI_RUT_AERO ON DIVIDIDOS.rutas (ORIGEN_ID);
    END

ALTER TABLE DIVIDIDOS.encomiendas
ADD CONSTRAINT ENCOMIENDAS_FK01 FOREIGN KEY
(BOLETO_COMPRA_ID) REFERENCES DIVIDIDOS.boletos_de_compra (ID)

IF NOT EXISTS(SELECT * FROM sys.indexes WHERE name = 'FKI_ENCO_BOLDECOMP' AND object_id = OBJECT_ID('DIVIDIDOS.encomiendas'))
    BEGIN
       CREATE INDEX FKI_ENCO_BOLDECOMP ON DIVIDIDOS.encomiendas (BOLETO_COMPRA_ID);
    END

ALTER TABLE DIVIDIDOS.encomiendas
ADD CONSTRAINT ENCOMIENDAS_FK02 FOREIGN KEY
(VUELO_ID) REFERENCES DIVIDIDOS.vuelos (ID)

IF NOT EXISTS(SELECT * FROM sys.indexes WHERE name = 'FKI_ENCO_VUEL' AND object_id = OBJECT_ID('DIVIDIDOS.encomiendas'))
    BEGIN
       CREATE INDEX FKI_ENCO_VUEL ON DIVIDIDOS.encomiendas (VUELO_ID);
    END

ALTER TABLE DIVIDIDOS.paquetes
ADD CONSTRAINT PAQUETES_FK01 FOREIGN KEY
(ENCOMIENDA_ID) REFERENCES DIVIDIDOS.encomiendas (ID)

IF NOT EXISTS(SELECT * FROM sys.indexes WHERE name = 'FKI_PAQ_ENCO' AND object_id = OBJECT_ID('DIVIDIDOS.paquetes'))
    BEGIN
       CREATE INDEX FKI_PAQ_ENCO ON DIVIDIDOS.paquetes (ENCOMIENDA_ID);
    END

ALTER TABLE DIVIDIDOS.canjes
ADD CONSTRAINT CANJES_FK01 FOREIGN KEY
(PRODUCTO_ID) REFERENCES DIVIDIDOS.productos (ID)

IF NOT EXISTS(SELECT * FROM sys.indexes WHERE name = 'FKI_CANJ_PROD' AND object_id = OBJECT_ID('DIVIDIDOS.canjes'))
    BEGIN
       CREATE INDEX FKI_CANJ_PROD ON DIVIDIDOS.canjes (PRODUCTO_ID);
    END

ALTER TABLE DIVIDIDOS.canjes
ADD CONSTRAINT CANJES_FK02 FOREIGN KEY
(CLIENTE_ID) REFERENCES DIVIDIDOS.clientes (ID)

IF NOT EXISTS(SELECT * FROM sys.indexes WHERE name = 'FKI_CANJ_CLIE' AND object_id = OBJECT_ID('DIVIDIDOS.canjes'))
    BEGIN
       CREATE INDEX FKI_CANJ_CLIE ON DIVIDIDOS.canjes (CLIENTE_ID);
    END

ALTER TABLE DIVIDIDOS.tarjetas_de_credito
ADD CONSTRAINT TARJETAS_DE_CREDITO_FK01 FOREIGN KEY
(CLIENTE_ID) REFERENCES DIVIDIDOS.clientes (ID)

IF NOT EXISTS(SELECT * FROM sys.indexes WHERE name = 'FKI_TARJCRED_CLIE' AND object_id = OBJECT_ID('DIVIDIDOS.tarjetas_de_credito'))
    BEGIN
       CREATE INDEX FKI_TARJCRED_CLIE ON DIVIDIDOS.tarjetas_de_credito (CLIENTE_ID);
    END

ALTER TABLE DIVIDIDOS.cancelaciones
ADD CONSTRAINT CANCELACIONES_FK01 FOREIGN KEY
(BOLETO_COMPRA_ID) REFERENCES DIVIDIDOS.boletos_de_compra (ID)

IF NOT EXISTS(SELECT * FROM sys.indexes WHERE name = 'FKI_CANC_BOLCOMP' AND object_id = OBJECT_ID('DIVIDIDOS.cancelaciones'))
    BEGIN
       CREATE INDEX FKI_CANC_BOLCOMP ON DIVIDIDOS.cancelaciones (BOLETO_COMPRA_ID);
    END

-----------------------------------------------------------------------
-- TRIGGERS